<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Animara's Creation</title>
  <link rel="icon" type="image/png" href="hearticon.png">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Federo&family=Ribeye&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Yrsa:ital,wght@0,300..700;1,300..700&display=swap" rel="stylesheet">
  <style>
    /* Your existing styles unchanged... */
    body {
      background-color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 30px;
      text-align: center;
      font-family: "Yrsa", serif;
      font-weight: 400;
    }
    .main-img {
      width: 300px;
      display: block;
      margin: 20px auto;
    }
    .earnMoreBtn {
      background-color: #A5CEE6;
      border: 1px solid #3A6494;
      border-radius: 10px;
      color: #000000;
      font-size: 18px;
      padding: 4px 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .earnMoreBtn:hover {
      background-color: #8BAED6;
      transform: scale(1.1);
    }
    .button-container {
      text-align: center;
      margin: 20px;
    }
    .boxes {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    .card {
      width: 280px;
      height: 280px;
      perspective: 1000px;
      position: relative;
    }
    .card-inner {
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
      border-radius: 10px;
      cursor: pointer;
    }
    .card.flipped .card-inner {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 10px;
    }
    .card-front {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-back {
      background: white;
      transform: rotateY(180deg);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-back img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }
    .card:hover .card-back img {
      transform: scale(1.2);
    }
    .blue { background-color: #3f8efc; }
    .yellow { background-color: #f9cc2f; }
    .purple { background-color: #a85ff0; }
    .card.glow-blue {
      box-shadow: 0 0 20px 5px rgba(63, 142, 252, 0.8);
    }
    .card.glow-yellow {
      box-shadow: 0 0 20px 5px rgba(249, 204, 47, 0.8);
    }
    .card.glow-purple {
      box-shadow: 0 0 20px 5px rgba(168, 95, 240, 0.8);
    }
    #collectionStatus {
      position: fixed;
      top: 10px;
      right: 10px;
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 5px;
      width: 220px;
      font-family: "Ribeye", serif;
    }
    .uncollected {
      color: #aaa;
    }
    .progress-bar {
      height: 10px;
      background: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: #e072b6;
      transition: width 0.5s ease-in-out;
    }
    .loading {
      font-size: 20px;
      text-align: center;
      animation: pulse 1s infinite;
      color: #555;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    .animate-glow {
      animation: glowBase 1s ease forwards;
    }
    @keyframes glowBase {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    #notEnough {
      color: red;
      font-weight: bold;
      display: none;
      margin-top: 10px;
    }
    #simon-container {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 430px;
      background: white;
      border: 2px solid #aaa;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    #score, #coinDisplay {
      font-family: "Yrsa", serif;
      font-weight: 400;
      text-align: center;
      margin-top: 5px;
    }
    #simonGame h1 {
      text-align: center;
      color: #e91e63;
      margin: 5px 0;
    }
    #difficulty-select {
      text-align: center;
      margin-bottom: 10px;
    }
    .difficulty-btn {
      padding: 6px 12px;
      margin: 0 4px;
      border: none;
      border-radius: 8px;
      background: #f48fb1;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
      font-size: 14px;
    }
    .difficulty-btn:hover {
      background: #ec407a;
    }
    .difficulty-btn:disabled {
      background: #e0e0e0;
      color: #888;
      cursor: not-allowed;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(2, 90px);
      grid-gap: 15px;
      justify-content: center;
      margin-top: 10px;
    }
    .btn {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: 4px solid white;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
      cursor: pointer;
      opacity: 0.9;
      transition: transform 0.1s, opacity 0.2s;
    }
    .btn:active {
      transform: scale(0.95);
    }
    .red { background: #ff6b6b; }
    .green { background: #81c784; }
    .blue { background: #64b5f6; }
    .yellow { background: #fff176; }
    .active {
      opacity: 1;
      box-shadow: 0 0 30px white, 0 0 10px #000;
      transform: scale(1.1);
    }
  </style>
</head>
<body>

  <div id="simon-container">
    <div id="simonGame" style="width: 430px; height: 375px;">
      <h1>Simon Says 🌸</h1>

      <div id="difficulty-select">
        <button class="difficulty-btn" onclick="startGame('easy')">Easy</button>
        <button class="difficulty-btn" onclick="startGame('medium')">Medium</button>
        <button class="difficulty-btn" onclick="startGame('hard')">Hard</button>
      </div>

      <div id="game-board">
        <div class="btn red" data-color="red"></div>
        <div class="btn green" data-color="green"></div>
        <div class="btn blue" data-color="blue"></div>
        <div class="btn yellow" data-color="yellow"></div>
      </div>

      <audio id="patternSound" src="simoncolor.mp3"></audio>
      <audio id="clickSound" src="simoncolor.mp3"></audio>
    </div>
    <div id="score">Score: 0</div>
    <div id="coinDisplay">Coins: 10</div>
  </div>

  <h1>Animara</h1>
  <img src="anakamain.png" alt="Main" class="main-img" />

  <div class="button-container">
    <button class="earnMoreBtn" onclick="doPull(1)">1 Pull</button>
    <button class="earnMoreBtn" onclick="doPull(5)">5 Pull</button>
    <div id="notEnough">You don't have enough coins!</div>
  </div>

  <div id="loading" class="loading" style="display:none;">Loading...</div>
  <div class="boxes" id="resultContainer"></div>
  <div id="collectionStatus"></div>
  <audio id="flipSound" src="click.mp3"></audio>

  <script>
    // Simon Says game variables
    const simonColors = ["red", "green", "blue", "yellow"];
    let simonSequence = [], simonUserSequence = [];
    let simonScore = 0;              // track successful rounds
    let simonClickable = false;
    let simonCoinGain = 1;
    let simonStarted = false;
    let simonOver = false;
    let simonDifficulty = "easy";

    const simonButtons = document.querySelectorAll("#game-board .btn");
    const simonPatternSound = document.getElementById("patternSound");
    const simonClickSound = document.getElementById("clickSound");
    const simonDiffBtns = document.querySelectorAll(".difficulty-btn");

    simonButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        if (!simonClickable || simonOver) return;
        const color = btn.dataset.color;
        simonUserSequence.push(color);
        simonFlash(btn);
        simonClickSound.currentTime = 0;
        simonClickSound.play();
        simonCheckInput();
      });
    });

    function startGame(diff) {
      if (simonStarted) return;
      simonOver = false;
      simonStarted = true;
      simonDifficulty = diff;
      simonSequence = [];
      simonUserSequence = [];
      simonScore = 0;  // reset internal game score on new game
      updateSimonScoreDisplay();
      simonLockBtns();

      simonCoinGain = diff === "medium" ? 3 : diff === "hard" ? 5 : 1;
      const rounds = diff === "medium" ? 2 : diff === "hard" ? 3 : 1;
      for (let i = 0; i < rounds; i++) simonAddToSequence();
      simonPlaySequence();
    }

    function simonLockBtns() {
      simonDiffBtns.forEach(btn => btn.disabled = true);
    }

    function simonUnlockBtns() {
      simonDiffBtns.forEach(btn => btn.disabled = false);
    }

    function simonAddToSequence() {
      const color = simonColors[Math.floor(Math.random() * simonColors.length)];
      simonSequence.push(color);
    }

    function simonNextRound() {
      simonClickable = false;
      simonUserSequence = [];
      if (simonDifficulty === "hard") {
        simonAddToSequence();
        simonAddToSequence();
      } else {
        simonAddToSequence();
      }
      simonPlaySequence();
    }

    function simonPlaySequence() {
      simonClickable = false;
      let delay = 0;
      simonSequence.forEach((color, idx) => {
        setTimeout(() => {
          if (simonOver) return;
          const btn = document.querySelector(`#game-board .btn.${color}`);
          simonFlash(btn);
          simonPatternSound.currentTime = 0;
          simonPatternSound.play();
        }, 700 * idx);
        delay = 700 * (idx + 1);
      });
      setTimeout(() => {
        if (!simonOver) simonClickable = true;
      }, delay);
    }

    function simonFlash(btn) {
      btn.classList.add("active");
      setTimeout(() => btn.classList.remove("active"), 400);
    }

    function simonCheckInput() {
      const idx = simonUserSequence.length - 1;
      if (simonUserSequence[idx] !== simonSequence[idx]) {
        alert("❌ Wrong pattern! Game over.");
        simonClickable = false;
        simonStarted = false;
        simonOver = true;
        simonUnlockBtns();
        return;
      }
      if (simonUserSequence.length === simonSequence.length) {
        simonScore++;
        simonCoinsEarned = simonCoinGain; // coins to add per successful round
        // Add coins only now, after success:
        coinCount += simonCoinsEarned;
        updateCoinDisplay();

        updateSimonScoreDisplay();
        setTimeout(() => {
          if (!simonOver) simonNextRound();
        }, 1000);
      }
    }

    function updateSimonScoreDisplay() {
      document.getElementById("score").textContent = "Score: " + simonScore;
    }

    // Items & Gacha setup
    const items = [
      { name: 'Myrrin', rarity: '4', image: 'myrrin3.png' },
      { name: 'Viola', rarity: '4', image: 'viola3.PNG' },
      { name: 'Soyul', rarity: '4', image: 'soyul3.png' },
      { name: 'Celestino', rarity: '5', image: 'cel3.PNG' },
      { name: 'Vex', rarity: '5', image: 'vex3.png' },
      { name: 'Anaka', rarity: '5', image: 'anaka3.PNG' },
      { name: 'Deviora', rarity: '5', image: 'deviora3.png' },
      { name: 'Kairo', rarity: '5', image: 'kairo3.PNG' },
      { name: 'Yunsu', rarity: '5', image: 'yunsu3.png' },
      { name: 'Alina', rarity: 'secret', image: 'alina3.png' }
    ];

    let coinCount = 10;
    const collection = {};
    items.forEach(item => collection[item.name] = 0);

    function updateCoinDisplay() {
      document.getElementById('coinDisplay').textContent = 'Coins: ' + coinCount;
      const buttons = document.querySelectorAll('.earnMoreBtn');
      buttons.forEach(btn => {
        const cost = parseInt(btn.textContent);
        btn.disabled = coinCount < cost;
      });
    }

    function updateCollectionDisplay() {
      const container = document.getElementById('collectionStatus');
      let collectedCount = 0;
      let content = '<strong>Collection Progress:</strong><ul style="list-style:none; padding-left: 0;">';

      items.forEach(item => {
        const count = collection[item.name];
        const owned = count > 0;
        if (owned) collectedCount++;
        content += `<li class="${owned ? '' : 'uncollected'}">${item.name}${count > 1 ? ' (' + count + ')' : ''}</li>`;
      });

      content += '</ul>';
      const progressPercent = (collectedCount / items.length) * 100;
      content += `<div class="progress-bar"><div class="progress-bar-fill" style="width:${progressPercent}%"></div></div>`;
      container.innerHTML = content;
    }

    function getRandomItem() {
      const roll = Math.random();
      const fourStars = items.filter(i => i.rarity === '4');
      const fiveStars = items.filter(i => i.rarity === '5');
      const secrets = items.filter(i => i.rarity === 'secret');

      if (roll < 0.3) return fourStars[Math.floor(Math.random() * fourStars.length)];
      if (roll < 0.9) return fiveStars[Math.floor(Math.random() * fiveStars.length)];
      return secrets[Math.floor(Math.random() * secrets.length)];
    }

    function doPull(count) {
      if (coinCount < count) {
        document.getElementById('notEnough').style.display = 'block';
        setTimeout(() => document.getElementById('notEnough').style.display = 'none', 2000);
        return;
      }

      coinCount -= count;
      updateCoinDisplay();

      const container = document.getElementById('resultContainer');
      const loader = document.getElementById('loading');
      container.innerHTML = '';
      loader.style.display = 'block';

      setTimeout(() => {
        loader.style.display = 'none';
        for (let i = 0; i < count; i++) {
          const item = getRandomItem();
          const card = document.createElement('div');
          card.className = 'card';
          const inner = document.createElement('div');
          inner.className = 'card-inner';
          const front = document.createElement('div');
          front.className = 'card-front ' + (item.rarity === '4' ? 'blue' : item.rarity === '5' ? 'yellow' : 'purple');
          const back = document.createElement('div');
          back.className = 'card-back';
          const img = document.createElement('img');
          img.src = item.image;
          img.alt = item.name;
          img.title = item.name;
          back.appendChild(img);
          inner.appendChild(front);
          inner.appendChild(back);
          card.appendChild(inner);

          card.addEventListener('click', () => {
            if (card.classList.contains('flipped')) return;
            card.classList.add('flipped');
            card.classList.add(`glow-${item.rarity === '4' ? 'blue' : item.rarity === '5' ? 'yellow' : 'purple'}`);
            card.classList.add('animate-glow');
            document.getElementById('flipSound').play();
            collection[item.name]++;
            updateCollectionDisplay();
          });

          container.appendChild(card);
        }
      }, 1500);
    }

    // Initialize displays on page load
    updateCollectionDisplay();
    updateCoinDisplay();

  </script>

</body>
</html>
